{% extends "admin/base.html" %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a></h1>
{% endblock %}

{% block nav-global %}
<div style="float: right; margin-top: 8px; margin-right: 20px; position: relative;">

    <a href="/admin/core/order/?status__exact=New" title="ç‚¹å‡»æŸ¥çœ‹æ–°è®¢å•" style="text-decoration: none; position: relative;">
        <span style="font-size: 20px; cursor: pointer;">ğŸ””</span>

        <span id="order-badge" style="display: none; background-color: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 10px; font-weight: bold; position: absolute; top: -8px; right: -5px;">0</span>
    </a>

</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {

        function checkNewOrders() {
            // è®¿é—®æˆ‘ä»¬åˆšæ‰å†™çš„æ¥å£
            fetch('/api/admin/check-orders/')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('order-badge');
                    if (data.count > 0) {
                        // å¦‚æœæœ‰æ–°è®¢å•ï¼šæ˜¾ç¤ºçº¢ç‚¹ï¼Œæ›´æ–°æ•°å­—
                        badge.style.display = 'inline-block';
                        badge.innerText = data.count;

                        // å¯é€‰ï¼šå¦‚æœè¦å¾ˆéªšæ°”åœ°å“ä¸€å£°ï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŠ  audio.play()
                    } else {
                        // æ²¡æœ‰æ–°è®¢å•ï¼šéšè—çº¢ç‚¹
                        badge.style.display = 'none';
                    }
                })
                .catch(err => console.error("æŸ¥è¯¢è®¢å•å¤±è´¥:", err));
        }

        // é¡µé¢åŠ è½½å®Œç«‹å³æŸ¥ä¸€æ¬¡
        checkNewOrders();

        // ä¹‹åæ¯ 5 ç§’è‡ªåŠ¨æŸ¥ä¸€æ¬¡ (è½®è¯¢)
        setInterval(checkNewOrders, 5000);
    });
</script>
{% endblock %}