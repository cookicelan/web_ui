<div class="card">
    {% if p.image %}
        <img src="{{ p.image.url }}" alt="{{ p.name }}" style="width:100%; height:160px; object-fit:contain; border-radius:5px; margin-bottom: 10px;">
    {% else %}
        <div style="width:100%; height:160px; background:#f0f0f0; text-align:center; line-height:160px; color:#aaa; border-radius:5px; margin-bottom: 10px;">暂无图片</div>
    {% endif %}

    <h3 style="font-size: 1.1em; margin: 5px 0; height: 44px; overflow: hidden;">{{ p.name }}</h3>
    <p style="color: #666; font-size: 0.9em; margin: 5px 0;">编码: {{ p.sku }}</p>

    {% if user.is_authenticated %}
        <p style="margin: 5px 0;">当前可用库存: <span style="color:green; font-weight:bold;">{{ p.visible_qty }}</span></p>

        <div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px;">
            <label style="font-weight: bold; color: #d9534f;">采购数量: </label>
            <input type="number" name="qty_{{ p.id }}" value="0" min="0" max="{{ p.visible_qty }}" style="width: 80px; padding: 5px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px;">
        </div>
    {% else %}
        <p class="blur-text" style="margin-top: 15px;">库存与下单功能登录后可见</p>
    {% endif %}
</div>