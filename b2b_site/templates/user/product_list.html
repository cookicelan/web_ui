<!DOCTYPE html>
<html>
<head>
    <title>äº§å“åˆ—è¡¨</title>
    <style>
        /* Tab æ ·å¼ */
        .tab-buttons { margin-bottom: 20px; text-align: center; }
        .tab-btn { padding: 10px 20px; cursor: pointer; background: #eee; border: none; font-size: 16px; margin: 0 5px; }
        .tab-btn.active { background: #007bff; color: white; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: flex; flex-wrap: wrap; justify-content: center;}

        /* å¡ç‰‡æ ·å¼ */
        .card { border:1px solid #ddd; padding:15px; margin:10px; width: 260px; border-radius: 8px; position: relative; }
        .price-tag { color: red; font-weight: bold; font-size: 1.2em; }
        .blur-text { filter: blur(4px); user-select: none; color: #999; } /* æ¨¡ç³Šæ•ˆæœ */

        /* ç™»å½•å¼¹çª—æ ·å¼ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: white; margin: 15% auto; padding: 30px; width: 400px; text-align: center; border-radius: 10px; }
        .modal-btn { display: block; width: 80%; margin: 10px auto; padding: 10px; text-decoration: none; border-radius: 5px; }
        .btn-login { background: #28a745; color: white; }
        .btn-register { background: #007bff; color: white; }
        .btn-skip { background: #6c757d; color: white; }
    </style>
</head>
<body>

    <div style="text-align: right; padding: 10px;">
        {% if user.is_authenticated %}
            <span>æ¬¢è¿, {{ user.username }} ({{ user.profile.country_suffix|default:"å…¨çƒ" }})</span>
            <a href="/admin/logout/">é€€å‡º</a>
        {% else %}
            <button onclick="document.getElementById('loginModal').style.display='block'">ç™»å½•/æ³¨å†Œ</button>
        {% endif %}
    </div>

    {% if show_login_modal %}
    <div id="loginModal" class="modal" style="display: block;">
        <div class="modal-content">
            <h2>æ¬¢è¿å…‰ä¸´ / Welcome</h2>
            <p>è¯·é€‰æ‹©æ“ä½œä»¥ç»§ç»­æŸ¥çœ‹å•†å“</p>

            <a href="/admin/login/?next=/" class="modal-btn btn-login">å·²æœ‰è´¦å·ï¼Ÿå»ç™»å½•</a>
            <a href="/register/" class="modal-btn btn-register">æ–°ç”¨æˆ·æ³¨å†Œ</a>
            <button onclick="document.getElementById('loginModal').style.display='none'" class="modal-btn btn-skip">æš‚æ—¶ä¸ç™»å½• (æ¸¸å®¢æ¨¡å¼)</button>
        </div>
    </div>
    {% endif %}

    <h1 style="text-align: center;">äº§å“é€‰è´­</h1>

    <div class="tab-buttons">
        <button class="tab-btn active" onclick="openTab('rec')">ğŸŒŸ æ¨èå•†å“ (Recommended)</button>
        <button class="tab-btn" onclick="openTab('stock')">ğŸ“¦ æœ‰è´§å•†å“ (In Stock)</button>
        <button class="tab-btn" onclick="openTab('nostock')">â³ ç¼ºè´§/äº¤æœŸ (Restocking)</button>
    </div>

    <div id="rec" class="tab-content active">
        {% if not recommended %} <p>æš‚æ— æ¨èå•†å“</p> {% endif %}
        {% for p in recommended %}
            {% include "user/product_card_snippet.html" with p=p %}
        {% endfor %}
    </div>

    <div id="stock" class="tab-content">
        {% for p in in_stock %}
            {% include "user/product_card_snippet.html" with p=p %}
        {% endfor %}
    </div>

    <div id="nostock" class="tab-content">
        {% for p in out_stock %}
            <div class="card" style="background-color: #f9f9f9;">
                <h3>{{ p.name }}</h3>
                <p style="font-size:0.9em;">{{ p.sku }}</p>
                <hr>
                <p style="color: orange; font-weight: bold;">âŒ æš‚æ—¶ç¼ºè´§</p>
                <p>
                    <strong>é¢„è®¡åˆ°è´§:</strong>
                    <span style="color: blue;">{{ p.next_arrival }}</span>
                </p>
                </div>
        {% endfor %}
    </div>

    <script>
        function openTab(tabName) {
            var i, x, tablinks;
            x = document.getElementsByClassName("tab-content");
            for (i = 0; i < x.length; i++) { x[i].className = "tab-content"; } // éšè—æ‰€æœ‰

            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) { tablinks[i].className = "tab-btn"; } // é‡ç½®æŒ‰é’®

            document.getElementById(tabName).className += " active"; // æ˜¾ç¤ºå½“å‰
            event.currentTarget.className += " active"; // é«˜äº®æŒ‰é’®
        }
    </script>

</body>
</html>