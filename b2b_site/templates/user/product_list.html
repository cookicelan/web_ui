<!DOCTYPE html>
<html>
<head>
    <title>äº§å“åˆ—è¡¨</title>
    <style>
        /* Tab æ ·å¼ */
        .tab-buttons { margin-bottom: 20px; text-align: center; }
        .tab-btn { padding: 10px 20px; cursor: pointer; background: #eee; border: none; font-size: 16px; margin: 0 5px; border-radius: 5px; }
        .tab-btn.active { background: #007bff; color: white; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: flex; flex-wrap: wrap; justify-content: center;}

        /* å¡ç‰‡æ ·å¼ */
        .card { border:1px solid #ddd; padding:15px; margin:10px; width: 260px; border-radius: 8px; position: relative; }
        .price-tag { color: red; font-weight: bold; font-size: 1.2em; }
        .blur-text { filter: blur(4px); user-select: none; color: #999; } /* æ¨¡ç³Šæ•ˆæœ */

        /* ç™»å½•å¼¹çª—æ ·å¼ */
        .modal { position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: white; margin: 15% auto; padding: 30px; width: 400px; text-align: center; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .modal-btn { display: block; width: 80%; margin: 15px auto; padding: 12px; text-decoration: none; border-radius: 5px; font-size: 16px; cursor: pointer; border: none; }
        .btn-login { background: #28a745; color: white; }
        .btn-register { background: #007bff; color: white; }
        .btn-skip { background: #6c757d; color: white; }

        .modal-btn:hover { opacity: 0.9; }
    </style>
</head>
<body>

    <div style="text-align: right; padding: 10px 20px; background-color: #f8f9fa; border-bottom: 1px solid #ddd;">
        {% if user.is_authenticated %}
            <span style="font-weight: bold; margin-right: 15px;">æ¬¢è¿æ‚¨, {{ user.username }} ({{ user.profile.country_suffix|default:"å…¨çƒ" }})</span>
            <a href="/logout/" style="color: red; text-decoration: none;">[ é€€å‡ºç™»å½• ]</a>
        {% else %}
            <button onclick="document.getElementById('loginModal').style.display='block'" style="padding: 8px 15px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px;">ç™»å½• / æ³¨å†Œ</button>
        {% endif %}
    </div>

    <div id="loginModal" class="modal" style="display: {% if show_login_modal %}block{% else %}none{% endif %};">
        <div class="modal-content">
            <h2>æ¬¢è¿å…‰ä¸´ / Welcome</h2>
            <p style="color: #666; margin-bottom: 20px;">è¯·é€‰æ‹©æ“ä½œä»¥ç»§ç»­æŸ¥çœ‹å•†å“ä¸“å±ä»·æ ¼ä¸äº¤æœŸ</p>

            <a href="/login/" class="modal-btn btn-login">å·²æœ‰è´¦å·ï¼Ÿå»ç™»å½•</a>
            <a href="/register/" class="modal-btn btn-register">æ–°ç”¨æˆ·æ³¨å†Œ</a>
            <button onclick="document.getElementById('loginModal').style.display='none'" class="modal-btn btn-skip">æš‚æ—¶ä¸ç™»å½• (æ¸¸å®¢æ¨¡å¼)</button>
        </div>
    </div>

    <h1 style="text-align: center; margin-top: 20px;">äº§å“é€‰è´­</h1>

<div class="tab-buttons">
        <button class="tab-btn active" onclick="openTab('rec')">ğŸŒŸ æ¨èå•†å“ (Recommended)</button>
        <button class="tab-btn" onclick="openTab('stock')">ğŸ“¦ æœ‰è´§å•†å“ (In Stock)</button>
        {% if user.is_authenticated %}
        <button class="tab-btn" onclick="openTab('nostock')">â³ ç¼ºè´§/äº¤æœŸ (Restocking)</button>
        {% endif %}
    </div>

    <form action="{% url 'checkout' %}" method="POST">
        {% csrf_token %} <div id="rec" class="tab-content active">
            {% if not recommended %} <p style="color: #999; margin-top: 20px;">æš‚æ— æ¨èå•†å“</p> {% endif %}
            {% for p in recommended %}
                {% include "user/product_card_snippet.html" with p=p %}
            {% endfor %}
        </div>

        <div id="stock" class="tab-content">
            {% for p in in_stock %}
                {% include "user/product_card_snippet.html" with p=p %}
            {% endfor %}
        </div>

        {% if user.is_authenticated %}
        <div id="nostock" class="tab-content">
            {% for p in out_stock %}
                <div class="card" style="background-color: #f9f9f9;">
                    <h3>{{ p.name }}</h3>
                    <p style="font-size:0.9em; color: #555;">{{ p.sku }}</p>
                    <hr>
                    <p style="color: #d9534f; font-weight: bold;">âŒ æš‚æ—¶ç¼ºè´§</p>

                    <div style="background-color: #e9ecef; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <p style="margin: 5px 0;">
                            <strong>é¢„è®¡åˆ°è´§:</strong>
                            <span style="color: #007bff; font-weight: bold;">{{ p.next_arrival }}</span>
                        </p>
                        <p style="margin: 5px 0;">
                            <strong>åœ¨é€”æ•°é‡:</strong>
                            <span style="color: #28a745; font-weight: bold;">{{ p.incoming_qty_display }}</span>
                        </p>
                    </div>
                </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if user.is_authenticated %}
        <div style="position: fixed; bottom: 0; left: 0; width: 100%; background-color: white; border-top: 2px solid #ddd; padding: 15px 0; text-align: center; box-shadow: 0 -4px 10px rgba(0,0,0,0.1); z-index: 999;">
            <button type="submit" style="background-color: #ff5722; color: white; border: none; padding: 12px 40px; font-size: 18px; font-weight: bold; border-radius: 30px; cursor: pointer;">
                ğŸ›’ é€‰å¥½äº†ï¼Œå»ç»“ç®— (Checkout)
            </button>
        </div>
        <div style="height: 80px;"></div>
        {% endif %}

    </form>
    <script>
        function openTab(tabName) {
            var i, x, tablinks;
            x = document.getElementsByClassName("tab-content");
            for (i = 0; i < x.length; i++) {
                x[i].className = "tab-content"; // éšè—æ‰€æœ‰
            }

            tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = "tab-btn"; // é‡ç½®æŒ‰é’®
            }

            var targetTab = document.getElementById(tabName);
            if(targetTab) {
                targetTab.className += " active"; // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹
            }
            event.currentTarget.className += " active"; // é«˜äº®å½“å‰ç‚¹å‡»çš„æŒ‰é’®
        }
    </script>

</body>
</html>